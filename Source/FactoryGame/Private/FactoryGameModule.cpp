// This file has been automatically generated by the Unreal Header Implementation tool

#include "FactoryGameModule.h"

#include "FGLocalizationSettings.h"
#include "Internationalization/StringTableRegistry.h"

void FFactoryGameModule::StartupModule() {
	const UFGLocalizationSettings* LocalizationSettings = UFGLocalizationSettings::Get();
	IFileManager::Get().IterateDirectoryStatRecursively(
		*(FPaths::ProjectContentDir() / LocalizationSettings->StringTablesFolder.Path),
		[](const TCHAR* FileName, const FFileStatData& FileStatData) -> bool {
			if (FileStatData.bIsDirectory) {
				return true;
			}
			if (FPaths::GetExtension(FileName).ToLower() != TEXT("csv")) {
				return true;
			}
			if (!FPaths::IsUnderDirectory(FileName, FPaths::ProjectContentDir())) {
				return true;
			}
			FString ContentPath = FPaths::ConvertRelativePathToFull(FileName);
			FPaths::MakePathRelativeTo(ContentPath, *FPaths::ProjectContentDir());
			FStringTableRegistry& Registry = FStringTableRegistry::Get();
			FString TableName = FPaths::GetBaseFilename(ContentPath);
			Registry.UnregisterStringTable(*TableName); // Ensure the table doesn't exist, such as when hot-reloading
			Registry.Internal_LocTableFromFile(*TableName, TableName, ContentPath, FPaths::ProjectContentDir());
			return true;
		});
}
void FFactoryGameModule::ShutdownModule(){ }
IMPLEMENT_PRIMARY_GAME_MODULE(FFactoryGameModule, FactoryGame, "FactoryGame");
